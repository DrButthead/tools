# Readme

This is a collection of small scripts and tools I have made to help my every day life. While I try to make these scripts as decoupled from my PC environment as I can, it's not a guarantee that any of these will work as expected on anything other than my main computer.

## converttomp3.ps1

This script will use ffmpeg in multiple threads to convert all .flac files inside the directory (and it's children) that the script is run in. ffmpeg and LAME must be installed (see [here](https://ffmpeg.org/download.html) and [here](https://lame.sourceforge.io/download.php)).

#### origins

My old car had an old version of bluetooth which made all audio sound kind of muddy, but it had a USB port you could plug a thumb drive into. I decided to plug an external USB HDD into it, but it turns out the car only supported mp3 files and no flac. I have a few albums in flac format on my computer, which obviously need converting so I created this script to simply convert all flac files in a directory.

## deleteDuplicates.ps1

This script has two folders defined inside, and checks every mp3 file in the source folder against the contents of the target folder. If there is a match, it deletes the file from the source folder.
In order to determine a match, it looks at a file in the source folder, and starts looping over all files in the target folder. Then, it creates an MD5 hash of the file, and compares it to the MD5 of the source file. If these don't match, it then uses a library called taglib ([here](https://github.com/illearth/powershell-taglib)) to get the MP3 tags from the file, and compares an AcoustID value. The AcoustID value is basically a fingerprint of a song (see [here](https://acoustid.org/)) and because I try to tag all of my music with Musicbrainz Picard ([here](https://picard.musicbrainz.org/)), most of my files have this value set. Any that don't have it set are ignored.

This all worked, but was very slow so I thought about some performance improvements, so the first step was to store the MD5 hash and AccoustID values in a map, so that they are a lot quicker to access for subsequent checks of files. This alone sped up the script massively, but it still wasn't enough. My next idea was to only check files that are withing a few KB in size, there's no chance a 3MB file will be the same as a 45MB file, and even if they are the same song I would want to double check myself. So I made the script only loop over files in the target directory which are up to 200KB smaller or larger than the source file. Again this was another big leap in performance, but I still had one Idea up my sleeve. I organise my music in a directory structure similar to `/[artist]/[album]/[song]` so I thought I would get the artist of the current song we're checking, then start the search in the `/[artist]/` folder and its subfolders. If there are no matches there, then the search gets expanded to the rest of the music folder. This was a slight improvement, but not as big of a leap as the other tweaks.

#### origins

At some point I had an issue with the NTFS MFT on one of my hard drives after installing Manjaro on it. Luckily the drive was only being used to store media, and all of my files / windows programs / games etc. were on a seperate HDD. All of my music, videos and pictures were backed up elsewhere anyway, so I was happy with doing a quick format to get the drive back up and running and restoring files from an old backup. My videos and pictures were backed up completely, but for some reason my music hadn't been backed up in about a year. After some digging and a lot of trial and error, I managed to ready almost all of the missing files that were still on the HDD, except they were in no directory structure at all and were all just dumped into a folder, with a lot of files having corrupted names. I restored all of my pictures / videos successfully and most of my music, but I wanted a way to restore the rest. I moved all of the music files into a separate directory, and wrote this script to remove any that were already restored. At the time of writing I haven't finished restoring everything, but I've removed hopefully around 90% of the duplicated files, where the rest will need manually sorting through.